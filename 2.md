# Entity Relationship Documentation

## Resource Management Tool - Database Schema

---

## 1. ENTITY SUMMARY

| Entity                     | Primary Key       | Type   | Purpose                  |
|----------------------------|-------------------|--------|--------------------------|
| Customer                   | SAPcustId         | String | Client organizations     |
| Opportunity                | sapOpportunityId  | String | Sales opportunities      |
| Project                    | sapPId            | String | Active projects          |
| Demand                     | demandId          | Integer| Resource requirements    |
| Employee                   | ohrId             | String | Workforce records        |
| EmployeeProjectAllocation  | allocationId      | UUID   | Employee-project assignments |
| Skills                     | id                | Integer| Master skill reference   |

---

## 2. RELATIONSHIPS & FOREIGN KEYS

### 2.1 Customer → Opportunity (1:N)
```
Opportunity.customerId → Customer.SAPcustId
```
One customer has multiple opportunities.

### 2.2 Opportunity → Project (1:N)
```
Project.oppId → Opportunity.sapOpportunityId
```
One opportunity generates multiple projects.

### 2.3 Project → Demand (1:N)
```
Demand.sapPId → Project.sapPId
```
One project has multiple resource demands.

### 2.4 Employee → Project (1:N) [as GPM]
```
Project.gpm → Employee.ohrId
```
One employee manages multiple projects as Global Project Manager.

### 2.5 Employee → Employee (1:N) [Hierarchy]
```
Employee.supervisorOHR → Employee.ohrId
```
Self-referential: One supervisor manages multiple subordinates.

### 2.6 Employee ↔ Project (N:M) [via EmployeeProjectAllocation]
```
EmployeeProjectAllocation.employeeId → Employee.ohrId
EmployeeProjectAllocation.projectId → Project.sapPId
```
Many employees work on many projects.

### 2.7 Demand → EmployeeProjectAllocation (1:N)
```
EmployeeProjectAllocation.demandId → Demand.demandId
```
One demand fulfilled by multiple allocations.

---

## 3. ENTITY RELATIONSHIP DIAGRAM

```
┌──────────┐
│ Customer │
└─────┬────┘
      │ 1:N (customerId)
      ▼
┌─────────────┐
│ Opportunity │
└──────┬──────┘
       │ 1:N (oppId)
       ▼
┌─────────┐         ┌──────────┐
│ Project │◄────────│ Employee │ (gpm)
└────┬────┘    1:N  └─────┬────┘
     │                    │
     │ 1:N                │ Self-ref (supervisorOHR)
     │                    │ 1:N
     ▼                    │
┌────────┐                │
│ Demand │                │
└───┬────┘                │
    │                     │
    │ 1:N                 │ 1:N
    │                     │
    └─────►┌──────────────────────────────┐◄──────┘
            │ EmployeeProjectAllocation    │
            └──────────────────────────────┘
                     (Junction Table)
```

---

## 4. FOREIGN KEY CONSTRAINTS

| Child Entity              | Foreign Key Column | Parent Entity | Parent Key      | Relationship |
|---------------------------|--------------------|---------------|-----------------|--------------|
| Opportunity               | customerId         | Customer      | SAPcustId       | N:1          |
| Project                   | oppId              | Opportunity   | sapOpportunityId| N:1          |
| Project                   | gpm                | Employee      | ohrId           | N:1          |
| Demand                    | sapPId             | Project       | sapPId          | N:1          |
| Employee                  | supervisorOHR      | Employee      | ohrId           | N:1          |
| EmployeeProjectAllocation | employeeId         | Employee      | ohrId           | N:1          |
| EmployeeProjectAllocation | projectId          | Project       | sapPId          | N:1          |
| EmployeeProjectAllocation | demandId           | Demand        | demandId        | N:1          |

---

## 5. KEY ATTRIBUTES BY ENTITY

### Customer
- **PK:** SAPcustId
- **Core:** customerName, country, status, vertical
- **Dates:** startDate, endDate

### Opportunity
- **PK:** sapOpportunityId
- **FK:** customerId
- **Core:** opportunityName, probability, Stage, tcv, currency
- **Dates:** expectedStart, expectedEnd

### Project
- **PK:** sapPId
- **FK:** oppId, gpm
- **Core:** projectName, status, projectType
- **Dates:** startDate, endDate
- **Metrics:** requiredResources, allocatedResources, toBeAllocated

### Demand
- **PK:** demandId
- **FK:** sapPId
- **Core:** skill, band, quantity
- **Calculated:** allocatedCount, remaining

### Employee
- **PK:** ohrId
- **FK:** supervisorOHR
- **Core:** fullName, band, role, skills (comma-separated)
- **Dates:** doj, lwd
- **Status:** status, employeeType

### EmployeeProjectAllocation
- **PK:** allocationId
- **FK:** employeeId, projectId, demandId
- **Core:** allocationPercentage (0-100%), status
- **Dates:** startDate, endDate, allocationDate

### Skills
- **PK:** id
- **Core:** name, category
- **Note:** Reference table only, no FK relationships

---

## 6. CARDINALITY MATRIX

| From Entity                | To Entity                  | Cardinality | Via          |
|----------------------------|----------------------------|-------------|--------------|
| Customer                   | Opportunity                | 1:N         | Direct       |
| Opportunity                | Project                    | 1:N         | Direct       |
| Project                    | Demand                     | 1:N         | Direct       |
| Project                    | EmployeeProjectAllocation  | 1:N         | Direct       |
| Employee                   | EmployeeProjectAllocation  | 1:N         | Direct       |
| Employee                   | Project (GPM)              | 1:N         | Direct       |
| Employee                   | Employee                   | 1:N         | Self-ref     |
| Demand                     | EmployeeProjectAllocation  | 1:N         | Direct       |
| Employee                   | Project                    | N:M         | Junction     |

---

## 7. SCHEMA HIGHLIGHTS

### Junction Tables
- **EmployeeProjectAllocation:** Resolves Employee ↔ Project many-to-many relationship

### Self-Referential Relationships
- **Employee.supervisorOHR:** Organizational hierarchy

### Calculated Fields
- **Demand.allocatedCount:** COUNT of matching allocations
- **Demand.remaining:** quantity - allocatedCount
- **Project.toBeAllocated:** requiredResources - allocatedResources

### Skill Management
- **Employee.skills:** Comma-separated string (e.g., "Java, Python, SAP")
- **Demand.skill:** Single skill string
- **Skills table:** Optional reference for standardization

---

## 8. DATA FLOW

```
Customer Registration
    ↓
Opportunity Creation
    ↓
Project Initiation
    ↓
Demand Definition (skill + quantity)
    ↓
Employee Allocation (matched to demand)
    ↓
Project Execution
```

---

## 9. INTEGRITY RULES

1. **Opportunity** must reference valid Customer
2. **Project** must reference valid Opportunity
3. **Demand** must reference valid Project
4. **Allocation** must reference valid Employee, Project, and Demand
5. **GPM** must be valid Employee
6. **Supervisor** must be valid Employee (can be NULL)
7. **Allocation.endDate** cannot exceed Project.endDate
8. **AllocationPercentage** must be 0-100

---

## END OF DOCUMENTATION